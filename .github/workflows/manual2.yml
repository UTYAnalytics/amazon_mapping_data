name: Run Selenium2 On GitHub Action

on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *' 

jobs:
  keepa_product_viewer:
    runs-on: ubuntu-latest
    timeout-minutes: 600000
    steps:
      - name: Checking out repo
        uses: actions/checkout@v3

      - name: Setting up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: Installing dependencies
        run: |
          pip install pandas
          pip install chromedriver-autoinstaller selenium pyvirtualdisplay
          pip install psycopg2
          pip install supabase
          pip install webdriver-manager
          pip install parsel
          pip install requests
          pip install scikit-image
          pip install numpy
          pip install opencv-python
          pip install matplotlib
          pip install fuzzywuzzy
          pip install python-Levenshtein
          pip install Pyarrow

      - name: Install xvfb
        run: sudo apt-get install xvfb
      - name: Download and install Google Chrome
        run: |
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo dpkg -i google-chrome-stable_current_amd64.deb
          sudo apt-get -f install
      # - name: Run Python script to check if update is needed
      #   id: check_update
      #   run: |
      #     python check_update_script.py  # Replace with your script to check the date
      #     echo "::set-output name=update_needed::$?"  # $? is the exit code of the last command

      - name: Running the keepa_product_viewer script
        run: python keepa_product_viewer.py
  
  get_data_map_selleramp:
    runs-on: ubuntu-latest
    timeout-minutes: 600000
    steps:
      - name: Checking out repo
        uses: actions/checkout@v3

      - name: Setting up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: Installing dependencies
        run: |
          pip install -r requirements.txt

      - name: Install xvfb
        run: sudo apt-get install xvfb
      - name: Download and install Google Chrome
        run: |
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo dpkg -i google-chrome-stable_current_amd64.deb
          sudo apt-get -f install

      - name: Running the keepa_product_viewer script
        run: python get_data_map_selleramp.py
